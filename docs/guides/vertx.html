<!DOCTYPE html>
<html>





<head>
  <title>Quarkus - Eclipse Vert.xの使用</title>
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/guides/vertx" />
  <meta property="og:title" content="Quarkus - Eclipse Vert.xの使用" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/guides/vertx">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/goan.js" type="text/javascript"></script>
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
</head>

<body class="guides">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJWS5L"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
  <div class="container">
    <div class="logo-wrapper">
      
        <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
      
    </div>
    <label class="nav-toggle" for="checkbox">
      <i class="fa fa-bars"></i>
    </label>
    <div id="menu" class="menu">
      <span>
        <a href="/get-started/" class="">はじめに</a>
      </span>
      <span>
        <a href="/guides/" class="active">ガイド</a>
      </span>
      <span>
        <a href="/community/" class="">コミュニティ</a>
      </span>
      <span>
        <a href="/support/" class="">サポート</a>
      </span>
      <span>
        <a href="/blog/" class="">ブログ</a>
      </span>
      <span>
        <a href="https://code.quarkus.io" class="button-cta secondary white">コーディングを開始</a>
      </span>
    </div>
  </div>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    


<div class="grid-wrapper guide">
  <div class="grid__item width-9-12 width-12-12-mobile">
    <h1 class="text-caps">Quarkus - Eclipse Vert.xの使用 </h1>
  </div>
  <div class="grid__item width-3-12 align-self-center text-right hide-mobile">
    <label id="guide-version-label">Select Guide Version</label>
    <select id="guide-version-dropdown">
      
        
        
        
        
          <option value="main" >Main - SNAPSHOT</option>
        
      
        
        
        
        
          <option value="latest" selected>2.0 - Latest</option>
        
      
        
        
        
        
          <option value="1.11" >1.11</option>
        
      
        
        
        
        
          <option value="1.7" >1.7</option>
        
      
    </select>
  </div>
  <div class="width-12-12">
    <div class="hide-mobile toc"><ul class="sectlevel1">
<li><a href="#インストール">インストール</a></li>
<li><a href="#ネイティブトランスポート">ネイティブトランスポート</a>
<ul class="sectlevel2">
<li><a href="#ネイティブlinuxトランスポート">ネイティブLinuxトランスポート</a></li>
<li><a href="#ネイティブmacosトランスポート">ネイティブMacOSトランスポート</a></li>
</ul>
</li>
<li><a href="#vert-xへのアクセス">Vert.xへのアクセス</a></li>
<li><a href="#reactive-jax-rsリソースでvert-xを使用する">Reactive JAX-RSリソースでVert.xを使用する</a>
<ul class="sectlevel2">
<li><a href="#非同期処理">非同期処理</a></li>
<li><a href="#streaming-using-server-sent-events">Streaming using Server-Sent Events</a></li>
<li><a href="#using-vert-x-json">Using Vert.x JSON</a></li>
</ul>
</li>
<li><a href="#using-vert-x-clients">Using Vert.x Clients</a>
<ul class="sectlevel2">
<li><a href="#picking-the-right-dependency">Picking the right dependency</a></li>
</ul>
</li>
<li><a href="#deploying-verticles">Deploying verticles</a></li>
<li><a href="#unix-ドメインソケットのリスニング">Unix ドメインソケットのリスニング</a></li>
<li><a href="#読み込み専用のデプロイ環境">読み込み専用のデプロイ環境</a></li>
<li><a href="#reverse-proxy">リバースプロキシーの背後での実行</a></li>
<li><a href="#same-site-cookie">SameSiteクッキー</a></li>
<li><a href="#さらに詳しく">さらに詳しく</a></li>
</ul></div>
    <div>
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Eclipse <a href="https://vertx.io">Vert.x</a>
は、リアクティブなアプリケーションを構築するためのツールキットです。軽量で埋め込み可能なように設計されています。Vert.xはリアクティブ実行モデルを定義し、大規模なエコシステムを提供します。</p>
</div>
<div class="paragraph">
<p>QuarkusはVert.xをベースにしており、ほとんどすべてのネットワーク関連機能はVert.xに依存しています。Quarkusのリアクティブ機能の多くはVert.xを
<em>表に出して</em>
いませんが、その下で使用されています。また、Quarkusは、Vert.xイベントバス(アプリケーションコンポーネント間の非同期メッセージングの受け渡しを可能にするため)やいくつかのリアクティブクライアントとスムーズに統合されています。また、Quarkusアプリケーションでは、さまざまなVert.x
APIを使用することができます(例えば、 <em>バーティクル</em> のデプロイ、クライアントのインスタンス化など)。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="インストール"><a class="anchor" href="#インストール"></a>インストール</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Vert.xにアクセスするに、この機能を利用するには、 <code>vertx</code> エクステンションを有効にする必要があります。新規プロジェクトを作成する場合は、
<code>extensions</code> パラメーターを以下のように設定します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn io.quarkus:quarkus-maven-plugin:2.0.2.Final:create \
    -DprojectGroupId=org.acme \
    -DprojectArtifactId=vertx-quickstart \
    -DclassName="org.acme.vertx.GreetingResource" \
    -Dpath="/hello" \
    -Dextensions="resteasy,vertx"
cd vertx-quickstart</code></pre>
</div>
</div>
<div class="paragraph">
<p>すでに作成済みのプロジェクトがある場合は、 <code>vertx</code> エクステンションを既存のQuarkusプロジェクトに <code>add-extension</code>
コマンドで追加することができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw quarkus:add-extension -Dextensions="vertx"</code></pre>
</div>
</div>
<div class="paragraph">
<p>そうでなければ、 <code>pom.xml</code> ファイルの依存関係セクションに手動で追加することができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-vertx&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ネイティブトランスポート"><a class="anchor" href="#ネイティブトランスポート"></a>ネイティブトランスポート</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Vert.x は <a href="https://netty.io/wiki/native-transports.html">Netty
のネイティブトランスポート</a>
を使用することができ、特定のプラットフォームでパフォーマンスを向上させることができます。これを有効にするには、プラットフォームに応じた適切な依存関係を含める必要があります。通常、アプリケーションのプラットフォームに依存しないようにするために、両方を含めるのが良いでしょう。Netty
は、サポートされていないプラットフォームでは何も含まれていない方を使うようにしています。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;io.netty&lt;/groupId&gt;
  &lt;artifactId&gt;netty-transport-native-epoll&lt;/artifactId&gt;
  &lt;classifier&gt;linux-x86_64&lt;/classifier&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
  &lt;groupId&gt;io.netty&lt;/groupId&gt;
  &lt;artifactId&gt;netty-transport-native-kqueue&lt;/artifactId&gt;
  &lt;classifier&gt;osx-x86_64&lt;/classifier&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>また、ネイティブトランスポートを使用するよう、Vert.x を明示的に設定する必要があります。 <code>application.properties</code>
で以下を追加します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.vertx.prefer-native-transport=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>または <code>application.yml</code> で以下を追加します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">quarkus:
  vertx:
    prefer-native-transport: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>すべてがうまくいけば、クァーカス以下のログ出力を行います。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[io.qua.ver.cor.run.VertxCoreRecorder] (main) Vertx has Native Transport Enabled: true</pre>
</div>
</div>
<div class="sect2">
<h3 id="ネイティブlinuxトランスポート"><a class="anchor" href="#ネイティブlinuxトランスポート"></a>ネイティブLinuxトランスポート</h3>
<div class="paragraph">
<p>Linuxでは、以下のソケットオプションを有効にすることができます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SOREUSEPORT</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>quarkus.http.so-reuse-port=true</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>TCP_QUICKACK</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>quarkus.http.tcp-quick-ack=true</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>TCP_CORK</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>quarkus.http.tcp-cork=true</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>TCP_FASTOPEN</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>quarkus.http.tcp-fast-open=true</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ネイティブmacosトランスポート"><a class="anchor" href="#ネイティブmacosトランスポート"></a>ネイティブMacOSトランスポート</h3>
<div class="paragraph">
<p>MacOS Sierra以上では、以下のソケットオプションを有効にすることができます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SOREUSEPORT</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>quarkus.http.so-reuse-port=true</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="vert-xへのアクセス"><a class="anchor" href="#vert-xへのアクセス"></a>Vert.xへのアクセス</h2>
<div class="sectionbody">
<div class="paragraph">
<p>エクステンションを追加したら、 <code>@Inject</code> を使用して <em>管理されている</em> Vert.x インスタンスにアクセスできます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject Vertx vertx;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Vert.x に詳しい方は、Vert.x が異なる API モデルを提供していることをご存知でしょう。 <em>素の</em> Vert.x
はコールバックを使用し、Mutiny バリアントは <code>Uni</code> と <code>Multi</code> を使用します。</p>
</div>
<div class="paragraph">
<p>Quarkusは2つのVert.x APIを提供しています。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名前</th>
<th class="tableblock halign-left valign-top">コード</th>
<th class="tableblock halign-left valign-top">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>bare</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Inject io.vertx.core.Vertx vertx</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>bare</em> Vert.x インスタンスの場合、API はコールバックを使用します。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://smallrye.io/smallrye-mutiny/">Mutiny</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Inject io.vertx.mutiny.core.Vertx vertx</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vert.x用のMutiny API</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You may inject any of the 2 flavors of <code>Vertx</code> as well as the <code>EventBus</code> in
your Quarkus application beans: <code>bare</code> and <code>Mutiny</code>.  They are just shims
and rely on a single <em>managed</em> Vert.x instance.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>ユースケースに応じてどちらかを選ぶことになります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>bare</code>: for advanced usage or if you have existing Vert.x code you want to
reuse in your Quarkus application</p>
</li>
<li>
<p><code>mutiny</code>: Mutiny is an event-driven reactive programming API. It uses 2
types: <code>Uni</code> and <code>Multi</code>. This is the recommended API.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following snippets illustrate the difference between these 4 APIs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Bare Vert.x:
vertx.fileSystem().readFile("lorem-ipsum.txt", ar -&gt; {
    if (ar.succeeded()) {
        System.out.println("Content:" + ar.result().toString("UTF-8"));
    } else {
        System.out.println("Cannot read the file: " + ar.cause().getMessage());
    }
});

// Mutiny Vert.x:
vertx.fileSystem().readFile("lorem-ipsum.txt")
    .onItem().transform(buffer -&gt; buffer.toString("UTF-8"))
    .subscribe()
    .with(
            content -&gt; System.out.println("Content: " + content),
            err -&gt; System.out.println("Cannot read the file: " + err.getMessage())
    );</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Mutiny</div>
<div class="paragraph">
<p>If you&#8217;re not familiar with Mutiny, we recommend to read the
<a href="getting-started-reactive#mutiny">Getting Started with Reactive guide</a>
first.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="reactive-jax-rsリソースでvert-xを使用する"><a class="anchor" href="#reactive-jax-rsリソースでvert-xを使用する"></a>Reactive JAX-RSリソースでVert.xを使用する</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quarkus web resources support asynchronous processing and streaming results
over
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events">server-sent
events</a>.</p>
</div>
<div class="sect2">
<h3 id="非同期処理"><a class="anchor" href="#非同期処理"></a>非同期処理</h3>
<div class="paragraph">
<p>To asynchronously handle the HTTP request, the endpoint method must return a
<code>java.util.concurrent.CompletionStage</code> or an <code>io.smallrye.mutiny.Uni</code>
(requires the <code>quarkus-resteasy-mutiny</code> extension):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Path("/lorem")
public class GreetingResource {

    @GET
    @Produces(MediaType.TEXT_PLAIN)
    public Uni&lt;String&gt; doSomethingAsync() {
        // Mimic an asynchronous computation.
        return Uni.createFrom()
                .item(() -&gt; "Hello!")
                .onItem().delayIt().by(Duration.ofMillis(10));
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw compile quarkus:dev</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, open your browser to <a href="http://localhost:8080/lorem" class="bare">http://localhost:8080/lorem</a> and you should get
the message.</p>
</div>
<div class="paragraph">
<p>ここまでは順調です。では、この人工的な遅延の代わりに Vert.x API を使ってみましょう。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.vertx;

import io.smallrye.mutiny.Uni;
import io.vertx.mutiny.core.Vertx;

import javax.inject.Inject;
import javax.ws.rs.GET;
import javax.ws.rs.Path;
import javax.ws.rs.Produces;
import javax.ws.rs.core.MediaType;

@Path("/lorem")
public class GreetingResource {

    @Inject
    Vertx vertx;

    @GET
    @Produces(MediaType.TEXT_PLAIN)
    public Uni&lt;String&gt; doSomethingAsync() {
        return vertx.fileSystem().readFile("/META-INF/resources/lorem.txt")
                .onItem().transform(b -&gt; b.toString("UTF-8"));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this code, we inject the <code>vertx</code> instance (<code>io.vertx.mutiny.core.Vertx</code>)
and read a file from the file system.</p>
</div>
<div class="paragraph">
<p>Create the <code>src/main/resources/META_INF/resources/lorem.txt</code> file with the
following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, refresh the page, you should see the <em>lorem ipsum</em> text.</p>
</div>
</div>
<div class="sect2">
<h3 id="streaming-using-server-sent-events"><a class="anchor" href="#streaming-using-server-sent-events"></a>Streaming using Server-Sent Events</h3>
<div class="paragraph">
<p>Quarkus web resources that need to send content as
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events">server-sent
events</a> must have a method:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>declaring the <code>text/event-stream</code> response content type</p>
</li>
<li>
<p>returning a <a href="https://www.reactive-streams.org/">Reactive Streams</a> <code>Publisher</code>
or Mutiny <code>Multi</code> (requires the <code>quarkus-resteasy-mutiny</code> extension)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In practice, a streaming greeting service would look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Path("/hello")
public class StreamingResource {

    @GET
    @Produces(MediaType.SERVER_SENT_EVENTS)
    @Path("/{name}")
    public Multi&lt;String&gt; greeting(@PathParam String name) {
        // TODO: create a Reactive Streams publisher or a Mutiny Multi
        return publisher;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we just need to return our <code>Publisher</code> or <code>Multi</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.vertx;

import io.smallrye.mutiny.Multi;
import io.vertx.mutiny.core.Vertx;
import org.jboss.resteasy.annotations.jaxrs.PathParam;

import javax.inject.Inject;
import javax.ws.rs.GET;
import javax.ws.rs.Path;
import javax.ws.rs.Produces;
import javax.ws.rs.core.MediaType;
import java.util.Date;

@Path("/stream")
public class StreamingResource {

    @Inject
    Vertx vertx;

    @GET
    @Produces(MediaType.SERVER_SENT_EVENTS)
    @Path("/{name}")
    public Multi&lt;String&gt; greeting(@PathParam String name) {
        return vertx.periodicStream(2000).toMulti()
                .map(l -&gt; String.format("Hello %s! (%s)%n", name, new Date()));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The server side is ready.  In order to see the result in the browser, we
need a web page.</p>
</div>
<div class="listingblock">
<div class="title">META-INF/resources/streaming.html</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="utf-8"/&gt;
    &lt;title&gt;SSE with Vert.x - Quarkus&lt;/title&gt;
    &lt;script type="application/javascript" src="streaming.js"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div id="container"&gt;&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Our web page just has an empty <code>&lt;div&gt;</code> container.  The magic, as always,
lies in the Javascript code:</p>
</div>
<div class="listingblock">
<div class="title">META-INF/resources/streaming.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">if (!!window.EventSource) {
    var eventSource = new EventSource("/stream/Quarkus");
    eventSource.onmessage = function (event) {
        var container = document.getElementById("container");
        var paragraph = document.createElement("p");
        paragraph.innerHTML = event.data;
        container.appendChild(paragraph);
    };
} else {
    window.alert("EventSource not available on this browser.")
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Most browsers support SSE but some don&#8217;t.  More about this in Mozilla&#8217;s
<a href="https://developer.mozilla.org/en-US/docs/Web/API/EventSource#Browser_compatibility">SSE
browser-compatibility list</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Navigate to <a href="http://localhost:8080/streaming.html" class="bare">http://localhost:8080/streaming.html</a>.  A new greeting should
show-up every 2 seconds.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">Hello Quarkus! (Wed Feb 12 17:13:55 CET 2020)

Hello Quarkus! (Wed Feb 12 17:13:57 CET 2020)

Hello Quarkus! (Wed Feb 12 17:13:59 CET 2020)

Hello Quarkus! (Wed Feb 12 17:14:01 CET 2020)

Hello Quarkus! (Wed Feb 12 17:14:03 CET 2020)

...</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-vert-x-json"><a class="anchor" href="#using-vert-x-json"></a>Using Vert.x JSON</h3>
<div class="paragraph">
<p>Vert.x API heavily relies on JSON, namely the
<code>io.vertx.core.json.JsonObject</code> and <code>io.vertx.core.json.JsonArray</code> types.
They are both supported as Quarkus web resource request and response bodies.</p>
</div>
<div class="paragraph">
<p>Consider these endpoints:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Path("/hello")
@Produces(MediaType.APPLICATION_JSON)
public class VertxJsonResource {

    @GET
    @Path("{name}/object")
    public JsonObject jsonObject(@PathParam String name) {
        return new JsonObject().put("Hello", name);
    }

    @GET
    @Path("{name}/array")
    public JsonArray jsonArray(@PathParam String name) {
        return new JsonArray().add("Hello").add(name);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In your browser, navigate to <a href="http://localhost:8080/hello/Quarkus/object" class="bare">http://localhost:8080/hello/Quarkus/object</a>. You
should see:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">{"Hello":"Quarkus"}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, navigate to <a href="http://localhost:8080/hello/Quarkus/array" class="bare">http://localhost:8080/hello/Quarkus/array</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">["Hello","Quarkus"]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Needless to say, this works equally well when the JSON content is a request
body or is wrapped in a <code>Uni</code>, <code>Multi</code>, <code>CompletionStage</code> or <code>Publisher</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-vert-x-clients"><a class="anchor" href="#using-vert-x-clients"></a>Using Vert.x Clients</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As you can inject a Vert.x instance, you can use Vert.x clients in a Quarkus
application.  This section gives an example with the <code>WebClient</code>.</p>
</div>
<div class="sect2">
<h3 id="picking-the-right-dependency"><a class="anchor" href="#picking-the-right-dependency"></a>Picking the right dependency</h3>
<div class="paragraph">
<p>Depending on the API model you want to use you need to add the right
dependency to your <code>pom.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!-- bare API --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;io.vertx&lt;/groupId&gt;
  &lt;artifactId&gt;vertx-web-client&lt;/artifactId&gt;
&lt;/dependency&gt;

&lt;!-- Mutiny API --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;io.smallrye.reactive&lt;/groupId&gt;
  &lt;artifactId&gt;smallrye-mutiny-vertx-web-client&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this guide, we are going to use the Mutiny API, so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;io.smallrye.reactive&lt;/groupId&gt;
  &lt;artifactId&gt;smallrye-mutiny-vertx-web-client&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, create a new resource in your project with the following content:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/org/acme/vertx/ResourceUsingWebClient.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.vertx;


import javax.annotation.PostConstruct;
import javax.inject.Inject;
import javax.ws.rs.GET;
import javax.ws.rs.Path;
import javax.ws.rs.Produces;
import javax.ws.rs.core.MediaType;

import io.smallrye.mutiny.Uni;
import org.jboss.resteasy.annotations.jaxrs.PathParam;

import io.vertx.mutiny.core.Vertx;
import io.vertx.mutiny.ext.web.client.WebClient;
import io.vertx.core.json.JsonObject;
import io.vertx.ext.web.client.WebClientOptions;

@Path("/fruit-data")
public class ResourceUsingWebClient {

    @Inject
    Vertx vertx;

    private WebClient client;

    @PostConstruct
    void initialize() {
        this.client = WebClient.create(vertx,
                new WebClientOptions().setDefaultHost("fruityvice.com")
                    .setDefaultPort(443).setSsl(true).setTrustAll(true));
    }

    @GET
    @Produces(MediaType.APPLICATION_JSON)
    @Path("/{name}")
    public Uni&lt;JsonObject&gt; getFruitData(@PathParam("name") String name) {
        return client.get("/api/fruit/" + name)
                .send()
                .onItem().transform(resp -&gt; {
                    if (resp.statusCode() == 200) {
                        return resp.bodyAsJsonObject();
                    } else {
                        return new JsonObject()
                                .put("code", resp.statusCode())
                                .put("message", resp.bodyAsString());
                    }
                });
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This resource creates a <code>WebClient</code> and upon request use this client to
invoke the <em>fruityvice</em> API.  Depending on the result the response is
forwarded as it&#8217;s received, or a new JSON object is created with the status
and body.  The <code>WebClient</code> is obviously asynchronous (and non-blocking), to
the endpoint returns a <code>Uni</code>.</p>
</div>
<div class="paragraph">
<p>Run the application with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw compile quarkus:dev</code></pre>
</div>
</div>
<div class="paragraph">
<p>And then, open a browser to: <code><a href="http://localhost:8080/fruit-data/pear" class="bare">http://localhost:8080/fruit-data/pear</a></code>. You
should get some details about pears.</p>
</div>
<div class="paragraph">
<p>The application can also run as a native executable.  But, first, we need to
instruct Quarkus to enable <em>ssl</em>.  Open the
<code>src/main/resources/application.properties</code> and add:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.ssl.native=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, create the native executable with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw package -Pnative</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deploying-verticles"><a class="anchor" href="#deploying-verticles"></a>Deploying verticles</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://vertx.io/docs/vertx-core/java/#_verticles">Verticles</a> is "a
simple, scalable, actor-like deployment and concurrency model" provided by
_Vert.x_.  This model does not claim to be a strict actor-model
implementation, but it does share similarities especially with respect to
concurrency, scaling and deployment.  To use this model, you write and
<em>deploy</em> verticles, communicating with each other by sending messages on the
event bus.</p>
</div>
<div class="paragraph">
<p>You can deploy <em>verticles</em> in Quarkus.  It supports:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>bare</em> verticle - Java classes extending <code>io.vertx.core.AbstractVerticle</code></p>
</li>
<li>
<p><em>Mutiny</em> verticle - Java classes extending
<code>io.smallrye.mutiny.vertx.core.AbstractVerticle</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To deploy verticles, use the regular Vert.x API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject Vertx vertx;

// ...
vertx.deployVerticle(MyVerticle.class.getName(), ar -&gt; { });
vertx.deployVerticle(new MyVerticle(), ar -&gt; { });</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also pass deployment options to configure the verticle as well as
set the number of instances.</p>
</div>
<div class="paragraph">
<p>Verticles are not <em>beans</em> by default.  However, you can implement them as
<em>ApplicationScoped</em> beans and get injection support:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package io.quarkus.vertx.verticles;

import io.smallrye.mutiny.Uni;
import io.smallrye.mutiny.vertx.core.AbstractVerticle;
import org.eclipse.microprofile.config.inject.ConfigProperty;

import javax.enterprise.context.ApplicationScoped;

@ApplicationScoped
public class MyBeanVerticle extends AbstractVerticle {

    @ConfigProperty(name = "address") String address;

    @Override
    public Uni&lt;Void&gt; asyncStart() {
        return vertx.eventBus().consumer(address)
                .handler(m -&gt; m.replyAndForget("hello"))
                .completionHandler();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You don&#8217;t have to inject the <code>vertx</code> instance but instead leverage the
instance stored in the protected field of <code>AbstractVerticle</code>.</p>
</div>
<div class="paragraph">
<p>Then, deploy the verticle instance with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package io.quarkus.vertx.verticles;

import io.quarkus.runtime.StartupEvent;
import io.vertx.mutiny.core.Vertx;

import javax.enterprise.context.ApplicationScoped;
import javax.enterprise.event.Observes;

@ApplicationScoped
public class VerticleDeployer {

    public void init(@Observes StartupEvent e, Vertx vertx, MyBeanVerticle verticle) {
         vertx.deployVerticle(verticle).await().indefinitely();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to deploy every exposed <code>AbstractVerticle</code>, you can use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void init(@Observes StartupEvent e, Vertx vertx, Instance&lt;AbstractVerticle&gt; verticles) {
    for (AbstractVerticle verticle : verticles) {
        vertx.deployVerticle(verticle).await().indefinitely();
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="unix-ドメインソケットのリスニング"><a class="anchor" href="#unix-ドメインソケットのリスニング"></a>Unix ドメインソケットのリスニング</h2>
<div class="sectionbody">
<div class="paragraph">
<p>unix ドメインソケットをリスンすることで、同じホストから quarkus サービスへの接続が確立されている場合、TCP
のオーバーヘッドを省くことができます。これはサービスへのアクセスがプロキシーを経由している場合に起こる可能性があり、Envoyのようなプロキシーでサービスメッシュを設定している場合によく起こります。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
これは、 <a href="#native-transport">[native-transport</a>] をサポートするプラットフォームでのみ動作します。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>設定するには、適切な <a href="#native-transport">native-transport</a>
を有効にし、以下の環境プロパティーを設定してください。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>quarkus.http.domain-socket=/var/run/io.quarkus.app.socket
quarkus.http.domain-socket-enabled=true</pre>
</div>
</div>
<div class="paragraph">
<p>By itself this will not disable the tcp socket which by default will open on
<code>0.0.0.0:8080</code>. It can be explicitly disabled:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>quarkus.http.host-enabled=false</pre>
</div>
</div>
<div class="paragraph">
<p>これらのプロパティーは、Java の <code>-D</code> コマンドライン・パラメーターまたは <code>application.properties</code>
で設定することが可能です。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="読み込み専用のデプロイ環境"><a class="anchor" href="#読み込み専用のデプロイ環境"></a>読み込み専用のデプロイ環境</h2>
<div class="sectionbody">
<div class="paragraph">
<p>読み取り専用のファイルシステムを使用している環境では、このような形式のエラーが発生することがあります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">java.lang.IllegalStateException: Failed to create cache dir</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>/tmp/</code> が書き込み可能である場合、 <code>vertx.cacheDirBase</code> プロパティーを <code>/tmp/</code>
のディレクトリーを指すように設定し、例えば OpenShift の場合は <code>JAVA_OPTS</code> に
<code>-Dvertx.cacheDirBase=/tmp/vertx</code> の値を持つ環境変数を作成することで修正できます。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="reverse-proxy"><a class="anchor" href="#reverse-proxy"></a>リバースプロキシーの背後での実行</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quarkus could be accessed through proxies that additionally generate headers
(e.g. <code>X-Forwarded-Host</code>) to keep information from the client-facing side of
the proxy servers that is altered or lost when they are involved.  In those
scenarios, Quarkus can be configured to automatically update information
like protocol, host, port and URI reflecting the values in these headers.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Activating this feature makes the server exposed to several security issues
(i.e. information spoofing).  Consider activate it only when running behind
a reverse proxy.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To setup this feature, please include the following lines in
<code>src/main/resources/application.properties</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.http.proxy-address-forwarding=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>To consider only de-facto standard header (<code>Forwarded</code> header), please
include the following lines in <code>src/main/resources/application.properties</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.http.proxy.allow-forwarded=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>To consider only non-standard headers, please include the following lines
instead in <code>src/main/resources/application.properties</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.http.proxy.proxy-address-forwarding=true
quarkus.http.proxy.enable-forwarded-host=true
quarkus.http.proxy.enable-forwarded-prefix=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both configurations related to standard and non-standard headers can be
combined, although the standard headers configuration will have precedence.</p>
</div>
<div class="paragraph">
<p>サポートされている転送アドレスヘッダは以下の通りです。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Forwarded</code></p>
</li>
<li>
<p><code>X-Forwarded-Proto</code></p>
</li>
<li>
<p><code>X-Forwarded-Host</code></p>
</li>
<li>
<p><code>X-Forwarded-Port</code></p>
</li>
<li>
<p><code>X-Forwarded-Ssl</code></p>
</li>
<li>
<p><code>X-Forwarded-Prefix</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="same-site-cookie"><a class="anchor" href="#same-site-cookie"></a>SameSiteクッキー</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One can easily add a
<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie/SameSite">SameSite</a>
cookie property to any of the cookies set by a Quarkus endpoint by listing a
cookie name and a <code>SameSite</code> attribute, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">quarkus.http.same-site-cookie.jwt.value=Lax
quarkus.http.same-site-cookie.session.value=Strict</code></pre>
</div>
</div>
<div class="paragraph">
<p>Given this configuration, the <code>jwt</code> cookie will have a <code>SameSite=Lax</code>
attribute and the <code>session</code> cookie will have a <code>SameSite=Strict</code> attribute.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="さらに詳しく"><a class="anchor" href="#さらに詳しく"></a>さらに詳しく</h2>
<div class="sectionbody">
<div class="paragraph">
<p>下にVert.xを使ったQuarkusの他の面はたくさんあります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The event bus is the connecting tissue of Vert.x applications.  Quarkus
integrates it so different beans can interact with asynchronous messages.
This part is covered in the <a href="reactive-event-bus">event bus
documentation</a>.</p>
</li>
<li>
<p>Data streaming and Apache Kafka are an important part of modern systems.
Quarkus integrates data streaming using Reactive Messaging.  More details on
<a href="kafka">Interacting with Kafka</a>.</p>
</li>
<li>
<p>Learn how to implement highly performant, low-overhead database applications
on Quarkus with the <a href="reactive-sql-clients">Reactive SQL Clients</a>.</p>
</li>
</ul>
</div>
</div>
</div>
    </div>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus はオープンです。このプロジェクトの全ての依存関係は<a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a>または互換性のあるライセンスの元で利用出来ます。<br /><br />このウェブサイトは <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a> で構築されており、<a href='https://pages.github.com/' target='_blank'>Github Pages</a>にホストされており、完全にオープンソースです。改善したい場合、 <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>ウェブサイトをフォークし</a>、修正してみせてください。</p>

    
      <div class="width-1-12 project-links">
        <span>ナビゲーション</span>
        <ul class="footer-links">
          
            <li><a href="/">ホーム</a></li>
          
            <li><a href="/guides">ガイド</a></li>
          
            <li><a href="/community/#contributing">貢献</a></li>
          
            <li><a href="/faq">FAQ</a></li>
          
            <li><a href="/get-started">はじめに</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>貢献</span>
        <ul class="footer-links">
          
            <li><a href="https://twitter.com/quarkusio">フォロー</a></li>
          
            <li><a href="https://github.com/quarkusio">GitHub</a></li>
          
            <li><a href="/security">セキュリティポリシー</a></li>
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>サポート</span>
        <ul class="footer-links">
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus">Stack Overflow</a></li>
          
            <li><a href="https://quarkusio.zulipchat.com">チャットルーム</a></li>
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev">フォーラム</a></li>
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkusはコミュニティプロジェクトで構成されています：</span>
        <ul class="footer-links">
          
            <li><a href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a href="https://code.quarkus.io/" target="_blank">等々...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a> | <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </span>
    <span class="redhat">
      Sponsored by
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/search-filter.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
</body>

</html>
